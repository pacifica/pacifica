language: python
sudo: required
services:
 - docker
python:
 - 2.7
env:
  DOCKER_COMPOSE_VERSION: 1.9.0

git:
  submodules: false
before_install:
 - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
 - git submodule update --init
 - sed -i 's/git@github.com:/https:\/\/github.com\//' docs/.gitmodules
 - git submodule update --init --recursive
 - sudo rm -f /usr/local/bin/docker-compose
 - sudo curl -L -o /usr/local/bin/docker-compose https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-$(uname -s)-$(uname -m)
 - sudo chmod +x /usr/local/bin/docker-compose
 - sudo service postgresql stop
 - docker-compose up -d metadataserver
 - cp metadata/server.conf archiveinterface/config.cfg docs/sphinx/
 - openssl aes-256-cbc -K $encrypted_94560f44e912_key -iv $encrypted_94560f44e912_iv -in deploy-key.enc -out ~/.ssh/deploy-key -d
install:
 - pip install -r docs/requirements.txt
 - pip install -r metadata/requirements.txt
 - pip install -r policy/requirements.txt
 - pip install -r cartd/requirements.txt
 - pip install -r ingest/requirements.txt
 - pip install -r uniqueid/requirements.txt
 - pip install -r proxy/requirements.txt
script: PACIFICA_ROOT=$PWD make -C docs/sphinx html
